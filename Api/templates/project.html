{#{% include 'header.html' %}#}
<!DOCTYPE html>
<html>
    <head>
        <title>API自动化测试用例</title>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        {% set pro_name = tasks['pro_name'] %}
        {% set nginx_api_proxy = tasks['nginx_api_proxy'] %}
        {% set host_list = tasks['host_list'] %}
        {% set global_variable_list = tasks['global_variable_list'] %}
        {% set cron_status = tasks['cron_status'] %}
        {% set test_case_list = tasks['test_case_list'] %}
        {% set statist_data = tasks['statist_data'] %}
        {% set is_run = tasks['is_run'] %}
        {% set current_report_url = tasks['current_report_url'] %}
        {% set history_report_path = tasks['history_report_path'] %}
        <link href="/{{nginx_api_proxy}}/static/css/bootstrap.min.css" rel="stylesheet">
        <link href="/{{nginx_api_proxy}}/static/css/sweetalert.min.css" rel="stylesheet"/>
        <link href="/{{nginx_api_proxy}}/static/css/font-awesome.css" rel="stylesheet"/>
        <link href="/{{nginx_api_proxy}}/static/css/dataTables.bootstrap.css" rel="stylesheet"/>
    </head>

    <body>
        <div id="page-wrapper">
            <div class="header" align="center">
                <h1 class="page-header"> API&nbsp;自&nbsp;动&nbsp;化&nbsp;测&nbsp;试&nbsp;用&nbsp;例&nbsp;-&nbsp;{{pro_name}}&nbsp;项&nbsp;目 </h1>
            </div>
            <div id="page-inner">
               <div class="row">
                  <div class="col-lg-12">

                      <div class="col-xs-12 col-md-4" style="margin-left:3%">
                          <div class="panel panel-success">
                             <div class="panel-heading" align="center" style="font-size:18px;font-weight: bold;">
                                 批&nbsp;&nbsp;&nbsp;量&nbsp;&nbsp;&nbsp;操&nbsp;&nbsp;&nbsp;作&nbsp;&nbsp;&nbsp;用&nbsp;&nbsp;&nbsp;例
                                 <a style="margin-left:10%;font-size:15px;" href="/api_case_tmpl" download="测试用例模板.xlsx"
                                    onMouseOver="this.style.cursor='hand',this.style.color='#FF0000'"
                                    onMouseOut="this.style.color='#006699'"> 导 入 模 板
                                </a>
                             </div>
                             <div class="panel-body">
                                 <form id="import_action_form" class="form-horizontal" enctype="multipart/form-data">
                                    <div class="col-sm-12">
                                        <div class="col-sm-7">
                                            <label style="font-size:15px; margin-left:10%;" class="text-success"> 用 例 文 件 格 式: xls xlsx csv</label>
                                            <input class="form-control" id="file" type="file" name="file"/>
                                        </div>
                                         {% if is_run %}
                                             <div class="col-sm-4" align="center" style="line-height:45px; font-size:15px; margin-left:5%; margin-top:2%;">
                                                 <button id="test_btn" name="test_btn" type="button" class="btn btn-success"  disabled="disabled"
                                                        onclick="export_result('{{ pro_name }}','{{ nginx_api_proxy }}')"> 导 出 Excel
                                                 </button>
                                             </div>
                                         {% else %}
                                             <div class="col-sm-4" align="center" style="line-height:45px; font-size:15px; margin-left:5%; margin-top:2%;">
                                                 <button id="test_btn" name="test_btn" type="button" class="btn btn-success"
                                                        onclick="export_result('{{ pro_name }}','{{ nginx_api_proxy }}')"> 导 出 Excel
                                                 </button>
                                             </div>
                                         {% endif %}
                                    </div>

                                    <div class="col-sm-12">
                                        <div class="col-sm-7" style="margin-top:2%;">
                                            <select class="form-control" name="import_method" id="import_method" style="text-align: center; text-align-last: center;">
                                                <option value="">请 选 择 导 入 方 式</option>
                                                <option value="batch_insert">批 量 新 增</option>
                                                <option value="all_replace">全 部 替 换</option>
                                                <option value="batch_insert_and_replace">批 量 新 增 + 替 换</option>
                                            </select>
                                        </div>
                                        {% if is_run %}
                                            <div class="col-sm-4" align="center" style="line-height:45px; margin-left:5%; margin-top:1%;">
                                                <button id="import_btn" name="import_btn" type="button" class="btn btn-success" disabled="disabled"
                                                        data-loading-text="Importing..." onclick="exec_import('{{ pro_name }}','{{ nginx_api_proxy }}')"> 批 量 导 入
                                                </button>
                                            </div>
                                        {% else %}
                                            <div class="col-sm-4" align="center" style="line-height:45px; margin-left:5%; margin-top:1%;">
                                                <button id="import_btn" name="import_btn" type="button" class="btn btn-success"
                                                        data-loading-text="Importing..." onclick="exec_import('{{ pro_name }}','{{ nginx_api_proxy }}')"> 批 量 导 入
                                                </button>
                                            </div>
                                        {% endif %}
                                    </div>
                                 </form>

                             </div>
                          </div>
                      </div>

                      <div class="col-xs-12 col-md-5">
                          <div class="panel panel-primary">
                             <div class="panel-heading" align="center" style="font-size:18px;font-weight: bold;">
                                 相&nbsp;&nbsp;&nbsp;关&nbsp;&nbsp;&nbsp;配&nbsp;&nbsp;&nbsp;置&nbsp;&nbsp;&nbsp;与&nbsp;&nbsp;&nbsp;操&nbsp;&nbsp;&nbsp;作
                             </div>
                             <div class="panel-body">
                                 <div class="col-sm-12">
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         <button class="btn btn-primary btn-icon" type="button" data-toggle="modal" data-target="#add_global_variable_form"> 配 置 全 局 变 量 </button>
                                     </div>
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         <button class="btn btn-primary btn-icon" type="button" data-toggle="modal" data-target="#add_host_form"> 配 置 HOST </button>
                                    </div>
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         {% if is_run %}
                                             <button id="on_line_all" type="button" class="btn btn-primary" disabled="disabled"
                                                 onclick="update_case_status_all('{{pro_name}}','true','{{nginx_api_proxy}}')"> 上 线 所 有 用 例 </button>
                                         {% else %}
                                             <button id="on_line_all" type="button" class="btn btn-primary"
                                                 onclick="update_case_status_all('{{pro_name}}','true','{{nginx_api_proxy}}')"> 上 线 所 有 用 例 </button>
                                         {% endif %}
                                     </div>
                                    <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         {% if is_run %}
                                             <button id="off_line_all" type="button" class="btn btn-primary" disabled="disabled"
                                                     onclick="update_case_status_all('{{pro_name}}','false','{{nginx_api_proxy}}')"> 下 线 所 有 用 例 </button>
                                         {% else %}
                                             <button id="off_line_all" type="button" class="btn btn-primary"
                                                     onclick="update_case_status_all('{{pro_name}}','false','{{nginx_api_proxy}}')"> 下 线 所 有 用 例 </button>
                                         {% endif %}
                                     </div>
                                 </div>

                                 <div class="col-sm-12">
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         <button id="check_global_variable_btn" type="button" class="btn btn-primary" onclick="check_global_variable('{{ pro_name }}','{{ nginx_api_proxy }}')"> 检 测 全 局 变 量 </button>
                                     </div>
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         <button id="check_depend_variable_btn" type="button" class="btn btn-primary" onclick="check_depend_variable('{{ pro_name }}','{{ nginx_api_proxy }}')"> 检 测 依 赖 变 量 </button>
                                     </div>
                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         <button id="stop_status_btn" type="button" class="btn btn-primary" onclick="stop_status('{{ pro_name }}','{{ nginx_api_proxy }}')"> 停 止 运 行 状 态</button>
                                     </div>

                                     <div class="col-sm-3" align="center" style="line-height:55px; font-size:15px;">
                                         {% if cron_status %}
                                            <button id="cron_status_btn" type="button" class="btn btn-success" onclick="update_cron_status('{{ pro_name }}','{{ nginx_api_proxy }}')"> 定 时 已 开 启</button>
                                         {% else %}
                                            <button id="cron_status_btn" type="button" class="btn btn-danger" onclick="update_cron_status('{{ pro_name }}','{{ nginx_api_proxy }}')"> 定 时 已 关 闭</button>
                                         {% endif %}
                                     </div>

                                 </div>

                             </div>
                          </div>
                      </div>

                      <div class="col-xs-12 col-md-2">
                          <div class="panel panel-warning">
                             <div class="panel-heading" align="center" style="font-size:18px; font-weight: bold;">
                                 报&nbsp;&nbsp;告&nbsp;&nbsp;与&nbsp;&nbsp;用&nbsp;&nbsp;例&nbsp;&nbsp;Excel
                             </div>
                             <div class="panel-body">
                                 <div class="col-sm-12">
                                     <div class="col-sm-12" align="center" style="line-height:55px; font-size:15px; margin-left:1%;">
                                         <a id="history_report_url" onclick="window.open('{{history_report_path}}')" class="text-warning"> 下 载 用 例 Excel </a>
                                         {# onMouseOver="this.style.cursor='hand'; this.style.color='#FF0000'" onMouseOut="this.style.color='#006699'"#}
                                     </div>
                                 </div>
                                 <div class="col-sm-12">
                                    <div class="col-sm-12" align="center" style="line-height:55px; font-size:15px; margin-left:1%;">
                                        <a id="history_report_url" onclick="window.open('/{{ nginx_api_proxy }}/API/get_test_report/{{ pro_name }}')" class="text-warning"> 查 看 测 试 报 告 </a>
                                    </div>
                                 </div>
                             </div>
                          </div>
                      </div>

                  </div>
               </div>
            </div>

            <div id="page-inner2">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="col-xs-12 col-md-11" style="margin-left:3%">
                        <div class="panel panel-info">
                            <div id="statist_data" class="panel-heading" align="left" style="font-size:20px; font-weight: bold;">
                                用 例 总 数（ <font color="#5B00AE">依 赖 : {{ statist_data['depend'] }} &nbsp;&nbsp; 测 试 : {{ statist_data['test'] }}</font> )  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                最 新 测 试 结 果  <  <font color="#5B4B00">总 计 : {{ statist_data['success'] + statist_data['fail'] + statist_data['error'] }}</font>&nbsp;&nbsp;&nbsp;
                                                    <font color="#008000">成 功 : {{ statist_data['success'] }}</font>&nbsp;&nbsp;&nbsp;&nbsp;
                                                    <font color="#FF0000">失 败 : {{ statist_data['fail'] }}</font>&nbsp;&nbsp;&nbsp;&nbsp;
                                                    <font color="#AE8F00">错 误 : {{ statist_data['error'] }}</font>&nbsp;&nbsp;&nbsp;>
                            </div>
                            <div class="panel-body">
                                <div class="card">
                                    <div class="card-body card-padding">
                                        <div class="row" role="form">
                                            <div class="col-sm-2">
                                                <div class="fg-line">
                                                    <input id="interface_name" name="interface_name" type="text" class="form-control" placeholder="接口名称">
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">请求方式：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="request_method" name="request_method" style="text-align: center; text-align-last: center;">
                                                            <option value="">全部</option>
                                                            <option value="GET">GET</option>
                                                            <option value="POST">POST</option>
                                                            <option value="PUT">PUT</option>
                                                            <option value="DELETE">DELETE</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">用例状态：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="case_status" name="case_status" style="text-align: center; text-align-last: center;">
                                                            <option value="">全部</option>
                                                            <option value="True">上线</option>
                                                            <option value="False">下线</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">最新执行时间：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="relate_run_time" name="relate_run_time" style="text-align: center; text-align-last: center;">
                                                            <option value="False">不关联</option>
                                                            <option value="True">关联</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            {# 选择 host #}
                                            <div class="col-sm-2" style="margin-left:50px">
                                                <div class="input-group">
                                                    <span class="input-group-addon">选择 HOST：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="host" name="host" style="text-align: center; text-align-last: center;">
                                                            <option value=""></option>
                                                            {% for host_dict in host_list %}
                                                                <option value="{{ host_dict["host_url"] }}">{{ host_dict["host_name"] }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" role="form" style="margin-top:10px">
                                            <div class="col-sm-2">
                                                <div class="fg-line">
                                                    <input id="interface_url" name="interface_url" type="text" class="form-control" placeholder="接口地址">
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">用例类型：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="is_depend" name="is_depend" style="text-align: center; text-align-last: center;">
                                                            <option value="">全部</option>
                                                            <option value="True">依赖</option>
                                                            <option value="False">测试</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">测试结果：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="test_result" name="test_result" style="text-align: center; text-align-last: center;">
                                                            <option value="">全部</option>
                                                            <option value="success">成功</option>
                                                            <option value="fail">失败</option>
                                                            <option value="error">错误</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            {# 搜索 按钮 #}
                                            <div class="col-sm-1" align="center">
                                                <div class="input-group" id="search_btn">
                                                   {# <button class="btn btn-primary btn-icon" onclick="search_case('{{ pro_name }}','{{ nginx_api_proxy }}')"><i class="fa fa-search"></i></button>#}
                                                    <button class="btn btn-primary btn-icon" onclick="search_case('{{ pro_name }}','{{ nginx_api_proxy }}')"> 搜 索 </button>
                                                </div>
                                            </div>
                                            {# 搜索 条数 #}
                                            <div class="col-sm-1" align="center" style="color:#5B00AE; line-height:35px; font-size:20px;" id="search_case_num">共 {{ statist_data['depend'] + statist_data['test'] }} 条</div>

                                            {# 测试 按钮 #} {# 执行 结果 #}
                                            {% if is_run %}
                                                <div class="col-sm-1" align="center" style="margin-left:50px">
                                                    <button id="test_btn" name="test_btn" type="button" class="btn btn-primary" disabled="disabled"
                                                            data-loading-text="Running..." onclick="exec_test('{{ pro_name }}','{{ nginx_api_proxy }}')"> 执行测试
                                                    </button>
                                                </div>
                                                <div class="col-sm-1" align="center" style="line-height:35px; font-size:20px;"><span id="result_info" class="label label-warning">当前项目正在运行中</span></div>
                                            {% else %}
                                                <div class="col-sm-1" align="center" style="margin-left:50px">
                                                    <button id="test_btn" name="test_btn" type="button" class="btn btn-primary"
                                                            data-loading-text="Running..." onclick="exec_test('{{ pro_name }}','{{ nginx_api_proxy }}')"> 执行测试
                                                    </button>
                                                </div>
                                                <div class="col-sm-1" align="center" style="line-height:35px; font-size:20px;"><span id="result_info" class="label label-info"></span></div>
                                            {% endif %}

                                            {# 新增用例 #}
                                            <div class="col-sm-1" align="center" style="margin-left:70px">
{#                                                <button class="btn btn-default" type="button" data-toggle="modal" data-target="#add_case_form"><i class="fa fa-plus-circle fa-2x" style="color: #BB5E00"></i></button>#}
                                                <button class="btn btn-primary btn-icon" type="button" data-toggle="modal" data-target="#add_case_form"> 新 增 用 例 </button>
                                            </div>


                                        </div>

                                        <div class="table-responsive" style="margin-top: 1%">
                                            <table class="table table-striped">
                                                <thead>
                                                <tr>
                                                    <th>接口名称</th>
                                                    <th class="text-center">请求方式</th>
                                                    <th>接口地址</th>
                                                    <th>验证关键字段</th>
                                                    <th class="text-center">验证模式</th>
                                                    <th class="text-center">用例状态</th>
                                                    <th class="text-center">测试结果</th>
                                                    <th class="text-center">上次测试时间</th>
                                                    <th class="text-center">操作</th>
                                                </tr>
                                                </thead>
                                                <tbody id="case_tbody">
                                                {% for test_case in test_case_list %}
                                                    {% set _id = test_case["_id"] %}
                                                    {% set interface_name = test_case["interface_name"] %}
                                                    {% set request_method = test_case["request_method"] %}
                                                    {% set request_header = test_case["request_header"] %}
                                                    {% set interface_url = test_case["interface_url"] %}
                                                    {% set request_params = test_case["request_params"] %}
                                                    {% set compare_core_field_name_list = test_case["compare_core_field_name_list"] %}
                                                    {% set expect_core_field_value_list = test_case["expect_core_field_value_list"] %}
                                                    {% set expect_field_name_list = test_case["expect_field_name_list"] %}
                                                    {% set verify_mode = test_case["verify_mode"] %}
                                                    {% set is_depend = test_case["is_depend"] %}
                                                    {% set depend_level = test_case["depend_level"] %}
                                                    {% set depend_field_name_list = test_case["depend_field_name_list"] %}
                                                    {% set depend_field_value_list = test_case["depend_field_value_list"] %}
                                                    {% set actual_core_field_value_list = test_case["actual_core_field_value_list"] %}
                                                    {% set actual_field_name_list = test_case["actual_field_name_list"] %}
                                                    {% set case_status = test_case["case_status"] %}
                                                    {% set exec_time = test_case["exec_time"] %}
                                                    {% set test_result = test_case["test_result"] %}
                                                    <tr>
                                                        {# 接口名称（测试信息） #}
                                                        {% if is_depend %}
                                                            <td style="width: 150px; display:table-cell; vertical-align:middle;" onclick="show_response_info('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}', '_case')" data-toggle="modal" data-target="#show_depend_response_info">{{ interface_name }} <font color="#BB5E00">(依赖)</font></td>
                                                        {% else %}
                                                            <td style="width: 150px; display:table-cell; vertical-align:middle;" onclick="show_response_info('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}', '_case')" data-toggle="modal" data-target="#show_test_response_info">{{ interface_name }}</td>
                                                        {% endif %}

                                                        {# 请求方式（请求头文件）#}
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="请求头文件" data-content="{{ request_header }}">{{ request_method }}</td>
                                                        {# 接口地址（请求参数）#}
                                                        <td style="width: 200px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="请求参数" data-content="{{ request_params }}">{{ interface_url }}</td>

                                                        {% if is_depend %}
                                                            {# 依赖字段值（依赖的字段名列表、依赖的字段值列表）#}
                                                            <td style="width: 150px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="字段名：{{ depend_field_name_list }}" data-content="字段值：{{ depend_field_value_list }}"><span style="font-size:14px" class="label label-info">依 赖 字 段 值</span></td>
                                                            {# 依赖等级 #}
                                                            <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;">依赖等级：{{ depend_level }}</td>
                                                        {% else %}
                                                            {# 验证关键字段（期望的关键字段值）#}
                                                            <td style="width: 150px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="期望的关键字段值" data-content="{{ expect_core_field_value_list }}">{{ compare_core_field_name_list }}</td>
                                                            {# 验证模式（期望的响应字段列表）#}
                                                            <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;">
                                                                {% if verify_mode == 1 %} 仅关键字段 {% else %} 关键字段+响应字段列表 {% endif %}
                                                            </td>
                                                        {% endif %}

                                                        {# 用例状态 #}
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;" onclick="update_case_status('{{pro_name}}','{{nginx_api_proxy}}','{{_id}}')" id="case_status_{{_id}}">
                                                        {% if case_status %}
                                                            <font color="#00A600">上线</font>
                                                        {% else %}
                                                            <font color="#DC143C">下线</font>
                                                        {% endif %}
                                                        </td>

                                                        {# 测试结果（测试结果信息）#}
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="测试结果信息" data-content="{{ test_result }}">
                                                            {% if is_depend %}
                                                                {% if "success" in test_result %}
                                                                    <font color="#00A600"> 依赖成功 </font>
                                                                {% elif "fail" in test_result %}
                                                                    <font color="#DC143C"> 依赖失败 </font>
                                                                {% elif "error" in test_result %}
                                                                    <font color="#C6A300"> 配置错误 </font>
                                                                {% else %}
                                                                {% endif %}
                                                            {% else %}
                                                                {% if "依赖" in test_result%}
                                                                    <span id="exec_result" style="font-size:14px" class="label label-warning"> 依赖错误 </span>
                                                                {% elif "success" in test_result %}
                                                                    <span id="exec_result" style="font-size:14px" class="label label-success"> 测试成功 </span>
                                                                {% elif "fail" in test_result %}
                                                                    <span id="exec_result" style="font-size:14px" class="label label-danger"> 测试失败 </span>
                                                                {% elif "error" in test_result %}
                                                                    <span id="exec_result" style="font-size:14px" class="label label-warning"> 配置错误 </span>
                                                                {% else %}
                                                                    <span id="exec_result" style="font-size:14px" class="label label-info"></span>
                                                                {% endif %}
                                                            {% endif %}
                                                        </td>

                                                        {# 上次执行时间 #}
                                                        <td class="text-center" style="width: 150px; display:table-cell; vertical-align:middle;">{{ exec_time }}</td>

                                                        {# 操作 #}
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;">
                                                            {% if is_run %}
                                                                <button class="btn btn-default" type="button" onclick="fill_edit_frame('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}', '_case')" data-toggle="modal" data-target="#edit_case_form" disabled="disabled"><i class="fa fa-edit" style="color: #6A5ACD"></i></button>
                                                                <button class="btn btn-default" type="button" onclick="del_case('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}')" disabled="disabled"><i class="fa fa-trash-o fa-lg" style="color: #ff0000"></i></button>
                                                            {% else %}
                                                                <button class="btn btn-default" type="button" onclick="fill_edit_frame('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}', '_case')" data-toggle="modal" data-target="#edit_case_form"><i class="fa fa-edit" style="color: #6A5ACD"></i></button>
                                                                <button class="btn btn-default" type="button" onclick="del_case('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}')"><i class="fa fa-trash-o fa-lg" style="color: #ff0000"></i></button>
                                                            {% endif %}

                                                        </td>
                                                    </tr>
                                                {% endfor %}

                                                </tbody>

                                            </table>

                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
        </div>

        <div style="position:fixed;right:50px; top:30px; width:20px; height:20px;cursor:pointer">
            <a href="../index">首页</a>
        </div>

        <!-- 回到顶部 -->
        <div style="position:fixed;right:50px; bottom:30px; width:20px; height:20px;cursor:pointer">
            <a href="#"><span class="glyphicon glyphicon-eject" style = "font-size:30px;" aria-hidden="true"></span></a>
        </div>

        <!-- 配置HOST窗口 -->
        <div id="add_host_form" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">配 置 HOST</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        {% for host_dict in host_list %}
                            <div class="form-group" style="margin-top:5px">
                                <label style="margin-left:5px;font-size:20px;" class="text-info"><font color="#5B00AE">{{ host_dict["host_name"] }}</font>&nbsp;&nbsp;->&nbsp;&nbsp;{{ host_dict["host_url"] }}</label>
                                <button style="margin-left:10px" class="btn" type="button" onclick="del_config('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ host_dict["config_id"] }}')">
                                    <i class="fa fa-trash-o fa-lg" style="color:#ff0000;margin-bottom:10px;"></i>
                                </button>
                            </div>
                        {% endfor %}
                        <div class="form-group" style="margin-top:30px">
                            <label>host_name：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="host_name_config">
                        </div>
                        <div class="form-group">
                            <label>host_value：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="host_value_config">
                        </div>
                        <div class="form-group">
                            <label><font color="#DC143C"> 目前支持测试的请求正文格式（Body） </font></label>
                            <label><font color="#DC143C"> 1. 表单格式：请求头 {"Content-Type":"application/x-www-form-urlencoded"}</font></label>
                            <label><font color="#DC143C"> 2. Json格式：请求头 {"Content-Type":"application/json"}</font></label>
                            <label><font color="#DC143C"> 3. 文件格式：请求头 不能含有"Content-Type"字段，请求参数里面必须要包含"file"字段 </font></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="config_host" onclick="config_variable('{{ pro_name }}','{{ nginx_api_proxy }}', 'host')"></span> 新增 or 更新 </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 配置全局变量窗口 -->
        <div id="add_global_variable_form" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">配 置 全 局 变 量</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        {% for global_variable_dict in global_variable_list %}
                            <div class="form-group" style="margin-top:5px">
                                <label style="margin-left:5px;font-size:20px;" class="text-info"><font color="#5B00AE">{{ global_variable_dict["global_variable_name"] }}</font>&nbsp;&nbsp;->&nbsp;&nbsp;{{ global_variable_dict["global_variable_value"] }}</label>
                                <button style="margin-left:10px" class="btn" type="button" onclick="del_config('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ global_variable_dict["config_id"] }}')">
                                    <i class="fa fa-trash-o fa-lg" style="color:#ff0000;margin-bottom:10px;"></i>
                                </button>
                            </div>
                        {% endfor %}
                        <div class="form-group" style="margin-top:30px">
                            <label>global_variable_name：<font color="#DC143C">(必填)</font><font color="#B8860B">  调 用 时 使 用 < > 标 记 </font></label>
                            <input class="form-control" type="text" id="global_variable_name_config">
                        </div>
                        <div class="form-group">
                            <label>global_variable_value：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="global_variable_value_config">
                        </div>
                        <div class="form-group">
                            <label><font color="#DC143C"> 注意：全局变量 在 { } 中 使用时需要带上双引号，比如 "< test >" ，同理 依赖变量 也是如此 </font></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="config_global_variable" onclick="config_variable('{{ pro_name }}','{{ nginx_api_proxy }}','global_variable')"></span> 新增 or 更新 </button>
                    </div>
                </div>
            </div>
        </div>


        <!-- 新增用例窗口 -->
        <div id="add_case_form" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">新增测试用例</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label class="text-info">接口名称：<font color="#DC143C">(必填)</font>
                                <button type="button" class="btn btn-primary btn-xs" style="margin-left:50px" onclick="get_current_case('{{ pro_name }}','{{ nginx_api_proxy }}')">获取已有用例</button>
                                <button type="button" class="btn btn-info btn-xs" style="margin-left:30px" onclick="clear_current_case()">清除</button>
                                <span id="get_current_case_info" style="margin-left:30px;font-size:12px;"></span>
                            </label>
                            <input class="form-control" type="text" id="interface_name_add"> <!-- placeholder="接口名称" -->
                        </div>
                        <div class="form-group">
                            <label class="text-info">接口地址：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="interface_url_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求方式：<font color="#DC143C">(必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="request_method_add">
                                    <option value=""></option>
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求头文件：<font color="#796400">eg: &nbsp;{"Content-Type": "application/json"} 或 x-www-form-urlencoded</font></label>
                            <input class="form-control" type="text" id="request_header_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求参数：<font color="#796400">eg: &nbsp;?name=测试&token=30&nbsp;&nbsp;或&nbsp;&nbsp;{"name":"测试","age":30}</font></label>
                            <input class="form-control" type="text" id="request_params_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">验证模式：<font color="#DC143C">(测试必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="verify_mode_add">
                                    <option value=""></option>
                                    <option value="1">仅验证关键字段</option>
                                    <option value="2">同时验证关键字段和验证响应参数列表</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">待比较关键字段名列表：<font color="#DC143C">(测试必填)&nbsp;&nbsp;</font><font color="#796400">eg：&nbsp;msg,code</font></label>
                            <input class="form-control" type="text" id="compare_core_field_name_list_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">期望的关键字段值列表：<font color="#DC143C">(测试必填)&nbsp;&nbsp;</font><font color="#796400">eg：&nbsp;请求成功,31200</font></label>
                            <input class="form-control" type="text" id="expect_core_field_value_list_add">
                        </div>

                        <div class="form-group">
                            <label class="text-info">期望的响应字段列表：</font><font color="#796400">eg: &nbsp;status,msg,code</font></label>
                            <input class="form-control" type="text" id="expect_field_name_list_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">是否为依赖接口：<font color="#DC143C">(必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="is_depend_add">
                                    <option value=""></option>
                                    <option value="False">否</option>
                                    <option value="True">是</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">依赖字段名列表：<font color="#DC143C">(依赖必填)&nbsp;&nbsp;</font></font><font color="#796400">eg: &nbsp;token,sms_code</font></label>
                            <input class="form-control" type="text" id="depend_field_name_list_add">
                        </div>
                        <div class="form-group">
                            <label class="text-info">依赖等级：<font color="#DC143C">(依赖必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="depend_level_add">
                                    <option value=""></option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">用例状态：</label>
                            <div class="fg-line">
                                <select class="form-control" id="case_status_add">
                                    <option value="False">下线</option>
                                    <option value="True">上线</option>
                                </select>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="save" onclick="add_case('{{ pro_name }}','{{ nginx_api_proxy }}')"><span class="glyphicon glyphicon-floppy-disk"></span>保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑用例窗口 -->
        <div id="edit_case_form" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">编辑测试用例</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label class="text-info">ID：</label>
                            <label id="case_id_edit"></label>
                        </div>
                        <div class="form-group">
                            <label class="text-info">接口名称：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="interface_name_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">接口地址：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="interface_url_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求方式：<font color="#DC143C">(必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="request_method_edit">
                                    <option value=""></option>
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求头文件：<font color="#796400">eg: &nbsp;{"Content-Type": "application/json"} 或 x-www-form-urlencoded</font></label>
                            <input class="form-control" type="text" id="request_header_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">请求参数：<font color="#796400">eg: &nbsp;?name=测试&age=30&nbsp;&nbsp;或&nbsp;&nbsp;{"name":"测试","age":30}</font></label>
                            <input class="form-control" type="text" id="request_params_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">验证模式：<font color="#DC143C">(测试必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="verify_mode_edit">
                                    <option value=""></option>
                                    <option value="1">仅验证关键字段</option>
                                    <option value="2">同时验证关键字段和验证响应参数列表</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">待比较关键字段名列表：<font color="#DC143C">(测试必填)&nbsp;&nbsp;</font><font color="#796400">eg：&nbsp;msg,code</font></label>
                            <input class="form-control" type="text" id="compare_core_field_name_list_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">期望的关键字段值列表：<font color="#DC143C">(测试必填)&nbsp;&nbsp;</font><font color="#796400">eg：&nbsp;请求成功,31200</font></label>
                            <input class="form-control" type="text" id="expect_core_field_value_list_edit">
                        </div>

                        <div class="form-group">
                            <label class="text-info">期望的响应字段列表：</font><font color="#796400">eg: &nbsp;status,msg,code</font></label>
                            <input class="form-control" type="text" id="expect_field_name_list_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">当 前 </label>
                            <label id="is_depend_edit" style="color: #DC143C; font-weight: bold;"></label>
                            <label class="text-info"> 依 赖 接 口 </label>
                        </div>
                        <div class="form-group">
                            <label class="text-info">依赖字段名列表：<font color="#DC143C">(依赖必填)&nbsp;&nbsp;</font></font><font color="#796400">eg: &nbsp;token,sms_code</font></label>
                            <input class="form-control" type="text" id="depend_field_name_list_edit">
                        </div>
                        <div class="form-group">
                            <label class="text-info">依赖等级：<font color="#DC143C">(依赖必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="depend_level_edit">
                                    <option value=""></option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-info">用例状态：</label>
                            <div class="fg-line">
                                <select class="form-control" id="case_status_edit">
                                    <option value="False">下线</option>
                                    <option value="True">上线</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="edit" onclick="edit_case('{{ pro_name }}','{{ nginx_api_proxy }}')"><span class="glyphicon glyphicon-floppy-disk"></span>更新</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- 显示测依赖口响应信息 -->
        <div id="show_depend_response_info" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">依 赖 接 口 响 应 信 息</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label>ID：</label>
                            <label id="case_id_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>依赖接口：</label>
                            <label id="is_depend_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>接口名称：</label>
                            <label id="interface_name_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>接口地址：</label>
                            <label id="interface_url_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>请求方式：</label>
                            <label id="request_method_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>请求头文件：</label>
                            <label id="request_header_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>请求参数：</label>
                            <label id="request_params_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>用例状态：</label>
                            <label id="case_status_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>运行状态：</label>
                            <label id="run_status_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>响应信息：</label>
                            <label id="response_info_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>依赖等级：</label>
                            <label id="depend_level_show_depend"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label><font color="#5B00AE">依赖字段名列表：</font></label>
                            <label id="depend_field_name_list_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">依赖字段值列表：</font></label>
                            <label id="depend_field_value_list_show_depend"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label><font color="#5B00AE">测试结果：</font></label>
                            <label id="test_result_show_depend"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label>更新时间：</label>
                            <label id="update_time_show_depend"></label>
                        </div>
                        <div class="form-group">
                            <label>创建时间：</label>
                            <label id="create_time_show_depend"></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 显示测试接口响应信息 -->
        <div id="show_test_response_info" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">测 试 接 口 响 应 信 息</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label>ID：</label>
                            <label id="case_id_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>依赖接口：</label>
                            <label id="is_depend_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>接口名称：</label>
                            <label id="interface_name_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>接口地址：</label>
                            <label id="interface_url_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>请求方式：</label>
                            <label id="request_method_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>请求头文件：</label>
                            <label id="request_header_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>请求参数：</label>
                            <label id="request_params_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>用例状态：</label>
                            <label id="case_status_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>运行状态：</label>
                            <label id="run_status_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>响应信息：</label>
                            <label id="response_info_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>验证模式：</label>
                            <label id="verify_mode_show_test"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label><font color="#5B00AE">待比较关键字段名列表：</font></label>
                            <label id="compare_core_field_name_list_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">期望的关键字段值列表：</font></label>
                            <label id="expect_core_field_value_list_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">实际的关键字段值列表：</font></label>
                            <label id="actual_core_field_value_list_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">关键字段值比较结果：</font></label>
                            <label id="result_core_field_value_show_test"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label><font color="#5B00AE">期望的响应字段列表：</font></label>
                            <label id="expect_field_name_list_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">实际的响应字段列表：</font></label>
                            <label id="actual_field_name_list_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label><font color="#5B00AE">响应字段列表比较结果：</font></label>
                            <label id="result_field_name_list_show_test"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label><font color="#5B00AE">测试结果：</font></label>
                            <label id="test_result_show_test"></label>
                        </div>
                        <hr />
                        <div class="form-group">
                            <label>更新时间：</label>
                            <label id="update_time_show_test"></label>
                        </div>
                        <div class="form-group">
                            <label>创建时间：</label>
                            <label id="create_time_show_test"></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="/{{nginx_api_proxy}}/static/scripts/jquery.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/bootstrap.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/common.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/project.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/sweetalert.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/jquery.dataTables.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/dataTables.bootstrap.js" type="text/javascript"></script>

        <!-- 激活 气泡弹层 -->
        <script type="text/JavaScript">
            $(function (){
                $("[data-toggle='popover']").popover();
            });
        </script>

        <!--若当前有用例在运行，则实时更新进度信息-->
        <script language="javascript" type="text/javascript">
            $(document).ready(function () {
                if('{{is_run}}' == 'True'){
                    background_polling('{{pro_name}}', '{{nginx_api_proxy}}');
                }
            });
        </script>

        <!-- 设置埋点，控制台显示页面的 '白屏时间' -->
        <script type="text/JavaScript">
            console.log("页面白屏时间 : " + (performance.timing['responseStart'] - performance.timing['navigationStart']).toString())
        </script>

    </body>
</html>
